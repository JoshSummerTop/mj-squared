<div class="container mx-auto px-4 py-8">
  <div class="flex justify-between items-center mb-8">
    <h1 class="text-3xl font-bold">Community Spaces</h1>
    <% if user_signed_in? %>
      <%= link_to 'Create Space', new_space_path, class: 'btn btn-primary' %>
    <% end %>
  </div>

  <!-- Category Tabs -->
  <div class="flex flex-wrap gap-2 mb-8">
    <%= link_to community_landing_path, 
        class: "px-4 py-2 rounded-lg border #{params[:tab].blank? ? 'bg-primary text-white border-primary' : 'border-gray-300 hover:border-primary'}" do %>
      All
    <% end %>
    <% @categories.each do |category| %>
      <%= link_to community_landing_path(tab: category.slug), 
          class: "px-4 py-2 rounded-lg border #{params[:tab] == category.slug ? 'bg-primary text-white border-primary' : 'border-gray-300 hover:border-primary'}" do %>
        <%= category.name %>
      <% end %>
    <% end %>
  </div>

  <!-- Your Spaces (if logged in and has spaces) -->
  <% if user_signed_in? && @joined_spaces.any? %>
    <div class="mb-12">
      <h2 class="text-2xl font-semibold mb-4">Your Spaces</h2>
      <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6">
        <% @joined_spaces.each do |space| %>
          <%= link_to space_path(space), class: "block bg-white rounded-lg shadow hover:shadow-lg transition-shadow border border-gray-200" do %>
            <div class="p-4">
              <% if space.image.attached? %>
                <%= image_tag space.image, class: "w-full h-32 object-cover rounded mb-4" %>
              <% else %>
                <div class="w-full h-32 bg-gray-200 rounded mb-4 flex items-center justify-center">
                  <span class="text-gray-500">No Image</span>
                </div>
              <% end %>
              <h3 class="text-lg font-semibold mb-2"><%= space.title %></h3>
              <div class="flex justify-between text-sm text-gray-600">
                <span><%= pluralize(space.memberships.count, 'member') %></span>
                <span><%= pluralize(space.posts.count, 'post') %></span>
              </div>
            </div>
          <% end %>
        <% end %>
      </div>
    </div>
  <% end %>

  <!-- Age Group Filters -->
  <div class="mb-6">
    <h2 class="text-2xl font-semibold mb-4">All Spaces</h2>
    <div class="flex flex-wrap gap-2">
      <%= link_to community_landing_path(tab: params[:tab]), 
          class: "px-3 py-1 text-sm rounded-full #{params[:age_group].blank? ? 'bg-secondary text-white' : 'bg-gray-100 hover:bg-gray-200'}" do %>
        All Ages
      <% end %>
      <% @age_groups.each do |age_group| %>
        <%= link_to community_landing_path(tab: params[:tab], age_group: age_group.slug), 
            class: "px-3 py-1 text-sm rounded-full #{params[:age_group] == age_group.slug ? 'bg-secondary text-white' : 'bg-gray-100 hover:bg-gray-200'}" do %>
          <%= age_group.name %>
        <% end %>
      <% end %>
    </div>
  </div>

  <!-- All Spaces Grid -->
  <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
    <% @spaces.each do |space| %>
      <div class="bg-white rounded-lg shadow hover:shadow-lg transition-shadow border border-gray-200">
        <%= link_to space_path(space), class: "block" do %>
          <% if space.image.attached? %>
            <%= image_tag space.image, class: "w-full h-48 object-cover rounded-t-lg" %>
          <% else %>
            <div class="w-full h-48 bg-gray-200 rounded-t-lg flex items-center justify-center">
              <span class="text-gray-500">No Image</span>
            </div>
          <% end %>
          <div class="p-4">
            <h3 class="text-xl font-semibold mb-2"><%= space.title %></h3>
            <p class="text-gray-600 mb-4"><%= truncate(space.description, length: 100) %></p>
            <div class="flex justify-between items-center">
              <span class="text-sm text-gray-500">
                <%= pluralize(space.memberships.count, 'member') %>
              </span>
              <span class="text-primary font-medium">View Space â†’</span>
            </div>
          </div>
        <% end %>
      </div>
    <% end %>
  </div>

  <% if @spaces.empty? %>
    <div class="text-center py-12">
      <p class="text-gray-500 text-lg">No spaces found.</p>
      <% if user_signed_in? %>
        <p class="text-gray-400 mt-2">Be the first to create one!</p>
        <%= link_to 'Create First Space', new_space_path, class: 'btn btn-primary mt-4' %>
      <% end %>
    </div>
  <% end %>
</div>

