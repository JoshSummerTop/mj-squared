<%= render ModalComponent.new(size: :lg, close_button: false) do |component| %>
      <button type="button" class="<%= local_assigns[:button_class] || 'btn-primary-enhanced hover-lift' %>" data-action="click->modal#open:prevent">
    <% if local_assigns[:action_text] == "Edit" %>
      <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path>
      </svg>
    <% else %>
      <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path>
      </svg>
    <% end %>
    <%= local_assigns[:action_text] || "Create Space" %>
  </button>

  <% component.capture_for :body do %>
    <div class="modal-header">
      <h2 class="text-2xl font-bold text-gray-900 mb-2">
        <%= local_assigns[:title] || "Create New Space" %>
      </h2>
      <p class="text-gray-600">Build a community space for meaningful conversations</p>
    </div>

    <turbo-frame id="space_modal_form">
      <%= form_with model: space, local: false, html: { multipart: true }, class: "space-y-8" do |f| %>
        <div class="form-group-enhanced">
          <%= f.label :title, class: "form-label-enhanced" %>
          <%= f.text_field :title, required: true, 
              placeholder: "What's your space about?",
              class: "form-input-enhanced" %>
        </div>

        <div class="form-group-enhanced">
          <%= f.label :description, class: "form-label-enhanced" %>
          <%= f.text_area :description, required: true, rows: 4,
              placeholder: "Tell others what your space is for...",
              class: "form-textarea-enhanced" %>
        </div>

        <div class="form-group-enhanced">
          <%= f.label :image, "Space Image (Optional)", class: "form-label-enhanced" %>
          <%= f.file_field :image, accept: "image/*",
              class: "form-file-enhanced" %>
          <% if space.persisted? %>
            <p class="text-sm text-gray-500 mt-1">Leave blank to keep current image</p>
            <% if space.image.attached? %>
              <div class="mt-3">
                <p class="text-sm text-gray-700 mb-2">Current image:</p>
                <%= image_tag space.image, class: "w-32 h-20 object-cover rounded-lg border border-gray-200" %>
              </div>
            <% end %>
          <% else %>
            <p class="text-sm text-gray-500 mt-1">Optional - Upload a custom image or leave blank to use a placeholder</p>
          <% end %>
        </div>

        <div class="form-group-enhanced">
          <%= f.label :community_category_ids, "Community Categories", class: "form-label-enhanced" %>
          <p class="text-sm text-gray-500 mb-3">Select at least one category that best describes your space</p>
          <div class="grid grid-cols-1 sm:grid-cols-2 gap-3 max-h-40 overflow-y-auto scrollbar-custom border border-gray-300 rounded-lg p-4 bg-gray-50">
            <%= f.collection_check_boxes :community_category_ids, CommunityCategory.all, :id, :name do |b| %>
              <label class="flex items-center cursor-pointer p-2 rounded-md hover:bg-white transition-colors duration-200">
                <%= b.check_box(class: "h-4 w-4 text-primary-600 focus:ring-primary-500 border-gray-300 rounded") %>
                <span class="ml-3 text-sm text-gray-900 font-medium"><%= b.text %></span>
              </label>
            <% end %>
          </div>
        </div>

        <div class="form-group-enhanced">
          <%= f.label :age_group_category_ids, "Age Groups", class: "form-label-enhanced" %>
          <p class="text-sm text-gray-500 mb-3">Select age groups this space is designed for</p>
          <div class="grid grid-cols-1 sm:grid-cols-2 gap-3 max-h-32 overflow-y-auto scrollbar-custom border border-gray-300 rounded-lg p-4 bg-gray-50">
            <%= f.collection_check_boxes :age_group_category_ids, AgeGroupCategory.all, :id, :name do |b| %>
              <label class="flex items-center cursor-pointer p-2 rounded-md hover:bg-white transition-colors duration-200">
                <%= b.check_box(class: "h-4 w-4 text-primary-600 focus:ring-primary-500 border-gray-300 rounded") %>
                <span class="ml-3 text-sm text-gray-900 font-medium"><%= b.text %></span>
              </label>
            <% end %>
          </div>
        </div>

        <% if space.errors.any? %>
          <div class="bg-red-50 border border-red-200 rounded-lg p-4">
            <div class="text-red-800 text-sm font-medium mb-2">Please fix the following errors:</div>
            <ul class="text-red-700 text-sm list-disc list-inside">
              <% space.errors.full_messages.each do |message| %>
                <li><%= message %></li>
              <% end %>
            </ul>
          </div>
        <% end %>

        <div class="flex gap-3 pt-6 border-t border-gray-200">
          <%= f.submit (space.persisted? ? "Update Space" : "Create Space"), 
              class: "flex-1 btn-primary-enhanced", 
              data: { disable_with: "Saving..." } %>
                              <button type="button" class="flex-1 btn-secondary-enhanced" data-action="modal#close:prevent">
                      Cancel
                    </button>
        </div>
      <% end %>
    </turbo-frame>
  <% end %>
<% end %>
