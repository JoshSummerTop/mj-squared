<% if @space.persisted? %>
  <turbo-stream action="replace" target="space_modal_form">
    <template>
      <div class="p-8 text-center">
        <!-- Success Icon -->
        <div class="mx-auto flex items-center justify-center h-16 w-16 rounded-full bg-green-100 mb-6">
          <svg class="h-8 w-8 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
          </svg>
        </div>
        
        <!-- Title -->
        <h3 class="text-xl font-bold text-gray-900 mb-3">Space Created!</h3>
        
        <!-- Message -->
        <p class="text-gray-600 mb-6 leading-relaxed">
          Your space <strong>"<%= @space.title %>"</strong> has been created successfully and is now available to the community.
        </p>
        
        <!-- Actions -->
        <div class="flex gap-3">
          <%= link_to "View Space", space_path(@space), 
              class: "flex-1 btn-primary-enhanced", 
              data: { turbo_frame: "_top", action: "click->modal#close" } %>
          <button type="button" class="flex-1 btn-secondary-enhanced" data-action="modal#close:prevent">
            Close
          </button>
        </div>
      </div>
    </template>
  </turbo-stream>

  <turbo-stream action="after" target="spaces-grid">
    <template>
      <div class="community-card-custom w-full h-52 animate-fade-in">
        <div class="community-card-inner">
          <div class="relative community-card-img-wrapper">
            <% if @space.image.attached? %>
              <%= image_tag @space.image, class: 'community-card-img', width: 104, height: 104, loading: 'lazy' %>
            <% else %>
              <%= image_tag 'community_placeholder.jpg', class: 'community-card-img', width: 104, height: 104, loading: 'lazy' %>
            <% end %>
          </div>
          <div class="community-card-content flex-1">
            <h3 class="text-lg mb-1 line-clamp-1"><%= truncate(@space.title, length: 25) %></h3>
            
            <% if @space.community_categories.any? %>
              <div class="flex flex-wrap gap-1 mb-1">
                <% @space.community_categories.each do |category| %>
                  <span class="px-2 py-0.5 bg-white bg-opacity-60 text-gray-800 text-xs rounded-full font-medium">
                    <%= category.name %>
                  </span>
                <% end %>
              </div>
            <% end %>
            
            <% if @space.age_group_categories.any? %>
              <div class="flex flex-wrap gap-1 mb-2">
                <% @space.age_group_categories.each do |age_group| %>
                  <span class="px-2 py-0.5 bg-orange-200 bg-opacity-80 text-orange-900 text-xs rounded-full font-medium">
                    <%= age_group.name %>
                  </span>
                <% end %>
              </div>
            <% end %>
            
            <p class="text-sm mb-2 text-black line-clamp-2"><%= truncate(@space.description, length: 80) %></p>
            <div class="community-card-actions">
              <span class="btn btn-secondary pointer-events-none select-none cursor-default"><%= pluralize(@space.memberships.count, 'member') %></span>
              <%= link_to 'View Space', space_path(@space), class: 'btn btn-primary border-0', data: { turbo_frame: "_top" } %>
            </div>
          </div>
        </div>
      </div>
    </template>
  </turbo-stream>
<% else %>
  <turbo-stream action="replace" target="space_modal_form">
    <template>
      <%= render "spaces/form_modal", space: @space, title: "Create New Space" %>
    </template>
  </turbo-stream>
<% end %>
