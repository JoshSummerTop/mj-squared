// @tiptap/extension-code-block@3.2.0 downloaded from https://ga.jspm.io/npm:@tiptap/extension-code-block@3.2.0/dist/index.js

import{Node as t,textblockTypeInputRule as e,mergeAttributes as r}from"@tiptap/core";import{Plugin as n,TextSelection as a,PluginKey as s,Selection as o}from"@tiptap/pm/state";var i=/^```([a-z]+)?[\s\n]$/;var l=/^~~~([a-z]+)?[\s\n]$/;var c=t.create({name:"codeBlock",addOptions(){return{languageClassPrefix:"language-",exitOnTripleEnter:true,exitOnArrowDown:true,defaultLanguage:null,HTMLAttributes:{}}},content:"text*",marks:"",group:"block",code:true,defining:true,addAttributes(){return{language:{default:this.options.defaultLanguage,parseHTML:t=>{var e;const{languageClassPrefix:r}=this.options;const n=[...((e=t.firstElementChild)==null?void 0:e.classList)||[]];const a=n.filter((t=>t.startsWith(r))).map((t=>t.replace(r,"")));const s=a[0];return s||null},rendered:false}}},parseHTML(){return[{tag:"pre",preserveWhitespace:"full"}]},renderHTML({node:t,HTMLAttributes:e}){return["pre",r(this.options.HTMLAttributes,e),["code",{class:t.attrs.language?this.options.languageClassPrefix+t.attrs.language:null},0]]},addCommands(){return{setCodeBlock:t=>({commands:e})=>e.setNode(this.name,t),toggleCodeBlock:t=>({commands:e})=>e.toggleNode(this.name,"paragraph",t)}},addKeyboardShortcuts(){return{"Mod-Alt-c":()=>this.editor.commands.toggleCodeBlock(),Backspace:()=>{const{empty:t,$anchor:e}=this.editor.state.selection;const r=e.pos===1;return!(!t||e.parent.type.name!==this.name)&&(!(!r&&e.parent.textContent.length)&&this.editor.commands.clearNodes())},Enter:({editor:t})=>{if(!this.options.exitOnTripleEnter)return false;const{state:e}=t;const{selection:r}=e;const{$from:n,empty:a}=r;if(!a||n.parent.type!==this.type)return false;const s=n.parentOffset===n.parent.nodeSize-2;const o=n.parent.textContent.endsWith("\n\n");return!(!s||!o)&&t.chain().command((({tr:t})=>{t.delete(n.pos-2,n.pos);return true})).exitCode().run()},ArrowDown:({editor:t})=>{if(!this.options.exitOnArrowDown)return false;const{state:e}=t;const{selection:r,doc:n}=e;const{$from:a,empty:s}=r;if(!s||a.parent.type!==this.type)return false;const i=a.parentOffset===a.parent.nodeSize-2;if(!i)return false;const l=a.after();if(l===void 0)return false;const c=n.nodeAt(l);return c?t.commands.command((({tr:t})=>{t.setSelection(o.near(n.resolve(l)));return true})):t.commands.exitCode()}}},addInputRules(){return[e({find:i,type:this.type,getAttributes:t=>({language:t[1]})}),e({find:l,type:this.type,getAttributes:t=>({language:t[1]})})]},addProseMirrorPlugins(){return[new n({key:new s("codeBlockVSCodeHandler"),props:{handlePaste:(t,e)=>{if(!e.clipboardData)return false;if(this.editor.isActive(this.type.name))return false;const r=e.clipboardData.getData("text/plain");const n=e.clipboardData.getData("vscode-editor-data");const s=n?JSON.parse(n):void 0;const o=s==null?void 0:s.mode;if(!r||!o)return false;const{tr:i,schema:l}=t.state;const c=l.text(r.replace(/\r\n?/g,"\n"));i.replaceSelectionWith(this.type.create({language:o},c));i.selection.$from.parent.type!==this.type&&i.setSelection(a.near(i.doc.resolve(Math.max(0,i.selection.from-2))));i.setMeta("paste",true);t.dispatch(i);return true}}})]}});var d=c;export{c as CodeBlock,i as backtickInputRegex,d as default,l as tildeInputRegex};

